---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: headlamp
  namespace: argocd
  labels:
    app.kubernetes.io/name: headlamp
    app.kubernetes.io/part-of: dashboard
    app.kubernetes.io/managed-by: argocd
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: default
  sources:
    # Helm chart for headlamp
    - repoURL: https://kubernetes-sigs.github.io/headlamp/
      chart: headlamp
      targetRevision: 0.38.0
      helm:
        releaseName: headlamp
        valuesObject:
          replicaCount: 1
          image:
            registry: ghcr.io
            repository: headlamp-k8s/headlamp
            pullPolicy: IfNotPresent
          service:
            type: ClusterIP
            port: 80
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 256Mi
          config:
            inCluster: true
          serviceAccount:
            create: true
            name: headlamp
          rbac:
            create: true
          persistentVolumeClaim:
            enabled: false
          affinity:
            nodeAffinity:
              preferredDuringSchedulingIgnoredDuringExecution:
                - weight: 100
                  preference:
                    matchExpressions:
                      - key: node-role.kubernetes.io/control-plane
                        operator: DoesNotExist
    # Additional resources (certificate, ingress)
    - repoURL: https://github.com/SecKatie/ansible-playbooks.git
      path: k8s-apps/headlamp/resources
      targetRevision: main
  destination:
    server: https://kubernetes.default.svc
    namespace: headlamp
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
