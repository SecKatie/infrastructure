# Perses Helm Chart Values
# Reference: https://github.com/perses/helm-charts

replicas: 1

image:
  registry: docker.io
  name: persesdev/perses
  version: v0.50.0-distroless
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 8080
  targetPort: 8080

resources:
  requests:
    cpu: 50m
    memory: 64Mi
  limits:
    cpu: 200m
    memory: 128Mi

# Persistence configuration
persistence:
  enabled: true
  storageClass: longhorn
  size: 5Gi
  accessModes:
    - ReadWriteOnce
  securityContext:
    fsGroup: 65534
    runAsUser: 65534
    runAsGroup: 65534
    runAsNonRoot: true

# Perses configuration
config:
  # Security configuration
  security:
    readonly: false
    enable_auth: false

  # Database configuration
  database:
    file:
      folder: "/perses/data"
      extension: "json"

  # Frontend configuration
  frontend:
    explorer:
      enable: true
    information: |
      ## Welcome to Perses

      Perses is a CNCF sandbox project for observability visualization.

      **Configured Datasources:**
      - VictoriaMetrics (Prometheus-compatible)

      **Documentation:** [perses.dev](https://perses.dev)

# Datasources configuration
datasources:
  - kind: Datasource
    metadata:
      name: victoriametrics
    spec:
      default: true
      plugin:
        kind: PrometheusDatasource
        spec:
          directUrl: http://victoria-metrics.monitoring.svc.cluster.local:8428

# Node affinity - prefer non-control-plane nodes
affinity:
  nodeAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        preference:
          matchExpressions:
            - key: node-role.kubernetes.io/control-plane
              operator: DoesNotExist

# Probes configuration
livenessProbe:
  enabled: true
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5

readinessProbe:
  enabled: true
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
