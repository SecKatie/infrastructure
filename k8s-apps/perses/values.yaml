# Perses Helm Chart Values
# Reference: https://github.com/perses/helm-charts

replicas: 1

service:
  type: ClusterIP
  port: 8080

resources:
  requests:
    cpu: 50m
    memory: 64Mi
  limits:
    cpu: 200m
    memory: 128Mi

# Persistence configuration
persistence:
  enabled: true
  storageClass: longhorn
  size: 5Gi
  accessModes:
    - ReadWriteOnce
  # Security context for persistent volume (only fsGroup is supported)
  securityContext:
    fsGroup: 65534

# Perses configuration
config:
  # Security configuration
  security:
    readonly: false
    enable_auth: false
    # Encryption key is provided via SealedSecret (see sealedsecret.yaml)
    # The key is loaded from the PERSES_SECURITY_ENCRYPTION_KEY environment variable
    authorization:
      guest_permissions:
        - actions: ["read"]
          scopes: ["*"]

  # Frontend configuration
  frontend:
    explorer:
      enable: true
    important_dashboards: []

  # Database configuration
  database:
    file:
      folder: "/perses"
      extension: "json"

  # Provisioning configuration
  provisioning:
    folders:
      - /etc/perses/provisioning
    interval: 10m

# Datasources configuration (DEPRECATED: use sidecar for provisioning)
datasources:
  - kind: GlobalDatasource
    metadata:
      name: victoriametrics
    spec:
      default: true
      display:
        name: VictoriaMetrics
      plugin:
        kind: PrometheusDatasource
        spec:
          proxy:
            kind: HTTPProxy
            spec:
              url: http://victoria-metrics.monitoring.svc.cluster.local:8428
              allowedEndpoints:
                - endpointPattern: "/api/v1/labels"
                  method: "POST"
                - endpointPattern: "/api/v1/labels"
                  method: "GET"
                - endpointPattern: "/api/v1/series"
                  method: "POST"
                - endpointPattern: "/api/v1/series"
                  method: "GET"
                - endpointPattern: "/api/v1/metadata"
                  method: "GET"
                - endpointPattern: "/api/v1/query"
                  method: "POST"
                - endpointPattern: "/api/v1/query"
                  method: "GET"
                - endpointPattern: "/api/v1/query_range"
                  method: "POST"
                - endpointPattern: "/api/v1/query_range"
                  method: "GET"
                - endpointPattern: "/api/v1/label/([a-zA-Z0-9_-]+)/values"
                  method: "GET"

# Probes configuration
livenessProbe:
  enabled: true
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  successThreshold: 1
  failureThreshold: 5

readinessProbe:
  enabled: true
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  successThreshold: 1
  failureThreshold: 5

# Secret configuration - use external SealedSecret instead of creating one
secret:
  create: false
  name: perses-config-secret
