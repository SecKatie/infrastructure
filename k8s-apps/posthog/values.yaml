# PostHog Helm chart values
# Chart: https://github.com/PostHog/charts-clickhouse

# Disable default ingress - we manage our own
ingress:
  enabled: false

# Web application
web:
  replicaCount: 1
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi

# Events processing
events:
  replicaCount: 1
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

# Worker for async tasks
worker:
  replicaCount: 1
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

# Plugins server
plugins:
  replicaCount: 1
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

# PostgreSQL - bundled for simplicity
postgresql:
  enabled: true
  auth:
    postgresPassword: posthog
    database: posthog
  primary:
    persistence:
      enabled: true
      size: 10Gi
      storageClass: longhorn
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi

# Redis - bundled for simplicity
redis:
  enabled: true
  architecture: standalone
  auth:
    enabled: false
  master:
    persistence:
      enabled: true
      size: 2Gi
      storageClass: longhorn
    resources:
      requests:
        cpu: 50m
        memory: 128Mi
      limits:
        cpu: 250m
        memory: 256Mi

# ClickHouse for analytics
clickhouse:
  enabled: true
  replicaCount: 1
  persistence:
    enabled: true
    size: 20Gi
    storageClass: longhorn
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 2Gi

# Kafka for event streaming
kafka:
  enabled: true
  replicaCount: 1
  persistence:
    enabled: true
    size: 5Gi
    storageClass: longhorn
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 1Gi

# ZooKeeper for Kafka/ClickHouse coordination
zookeeper:
  enabled: true
  replicaCount: 1
  persistence:
    enabled: true
    size: 2Gi
    storageClass: longhorn
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 250m
      memory: 512Mi

# Node affinity - prefer non-control-plane nodes
affinity:
  nodeAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        preference:
          matchExpressions:
            - key: node-role.kubernetes.io/control-plane
              operator: DoesNotExist
