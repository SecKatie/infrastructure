---
# =============================================================================
# Observability Stack Playbook
# =============================================================================
# This playbook deploys the complete observability and monitoring stack:
#   - Victoria Metrics (Prometheus-compatible metrics storage)
#   - Node Exporter (System metrics collection)
#   - Grafana (Metrics visualization and dashboards)
#
# Prerequisites:
#   - vars/grafana_secrets.yml must exist and be encrypted with ansible-vault
#
# Usage:
#   ansible-playbook -i inventory/hosts.yml playbooks/observability.yml
#
#   # Deploy only Victoria Metrics
#   ansible-playbook -i inventory/hosts.yml playbooks/observability.yml --tags victoria_metrics
#
#   # Deploy only Grafana
#   ansible-playbook -i inventory/hosts.yml playbooks/observability.yml --tags grafana
#
# Tags:
#   - observability: All observability components
#   - monitoring: All monitoring components
#   - victoria_metrics: Victoria Metrics deployment
#   - prometheus: Prometheus-compatible components
#   - node_exporter: Node Exporter DaemonSet
#   - grafana: Grafana dashboard
# =============================================================================

- name: Deploy observability stack
  hosts: localhost
  connection: local
  gather_facts: false
  tags: [observability, monitoring]
  vars_files:
    - vars/grafana_secrets.yml
  roles:
    - role: observability_victoria_metrics
      tags: [victoria_metrics, prometheus]

    - role: observability_node_exporter
      tags: [node_exporter]

    - role: observability_grafana
      tags: [grafana]
