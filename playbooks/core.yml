---
# =============================================================================
# Kubernetes Core Components Playbook
# =============================================================================
# This playbook deploys core Kubernetes infrastructure components:
#   - Storage: Longhorn distributed storage
#   - Security: cert-manager for TLS certificates
#   - Networking: Traefik with ACME/Let's Encrypt
#
# Prerequisites:
#   - vars/cloudflare_secrets.yml must exist and be encrypted with ansible-vault
#
# Usage:
#   ansible-playbook -i inventory/hosts.yml playbooks/core.yml
#
#   # Deploy only storage
#   ansible-playbook -i inventory/hosts.yml playbooks/core.yml --tags storage
#
#   # Deploy only security components
#   ansible-playbook -i inventory/hosts.yml playbooks/core.yml --tags security
#
# Tags:
#   - core: All core components
#   - storage: Storage solutions
#   - longhorn: Longhorn distributed storage
#   - security: Security components
#   - cert-manager: cert-manager for TLS certificates
#   - networking: Networking components
#   - traefik: Traefik ingress controller
#   - acme: ACME/Let's Encrypt configuration
#   - tls: TLS/SSL configuration
#   - gitops: GitOps components
#   - argocd: ArgoCD continuous delivery

# =============================================================================

- name: Deploy Kubernetes core components
  hosts: localhost
  connection: local
  gather_facts: false
  tags: [kubernetes, core]
  vars_files:
    - vars/cloudflare_secrets.yml
  roles:
    # Storage
    - role: core_longhorn
      tags: [storage, longhorn]

    # Security
    - role: core_cert_manager
      tags: [security, cert-manager, tls]

    # Networking
    - role: core_traefik
      tags: [networking, traefik, acme, tls]

    # GitOps
    - role: core_argocd
      tags: [gitops, argocd]
