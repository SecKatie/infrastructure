---
- name: Validate required variables
  ansible.builtin.assert:
    that:
      - cloudflared_tunnel_name is defined
      - cloudflared_tunnel_name | length > 0
      - cloudflared_hostname is defined
      - cloudflared_hostname | length > 0
      - cloudflared_service_url is defined
      - cloudflared_service_url | length > 0
    fail_msg: |
      Required variables missing:
        - cloudflared_tunnel_name: {{ cloudflared_tunnel_name | default('NOT DEFINED') }}
        - cloudflared_hostname: {{ cloudflared_hostname | default('NOT DEFINED') }}
        - cloudflared_service_url: {{ cloudflared_service_url | default('NOT DEFINED') }}

- name: Import tunnel creation tasks (runs on controller)
  ansible.builtin.import_tasks: tunnel.yml

- name: Import installation tasks
  ansible.builtin.import_tasks: install.yml

- name: Import configuration tasks
  ansible.builtin.import_tasks: configure.yml
